[1mdiff --git a/lab5/src/mutex.c b/lab5/src/mutex.c[m
[1mindex 4e86390..2a59fab 100755[m
[1m--- a/lab5/src/mutex.c[m
[1m+++ b/lab5/src/mutex.c[m
[36m@@ -15,78 +15,159 @@[m
 #include <stdio.h>[m
 #include <stdlib.h>[m
 [m
[32m+[m[32m// –û–±—ä—è–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π[m
 void do_one_thing(int *);[m
 void do_another_thing(int *);[m
 void do_wrap_up(int);[m
[31m-int common = 0; /* A shared variable for two threads */[m
[31m-int r1 = 0, r2 = 0, r3 = 0;[m
[32m+[m
[32m+[m[32m// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ[m
[32m+[m[32mint common = 0; /* –û–±—â–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –¥–≤—É—Ö –ø–æ—Ç–æ–∫–æ–≤ */[m
[32m+[m[32mint r1 = 0, r2 = 0, r3 = 0; /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */[m
[32m+[m
[32m+[m[32m// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º—å—é—Ç–µ–∫—Å–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–∏–º –¥–∞–Ω–Ω—ã–º[m
 pthread_mutex_t mut = PTHREAD_MUTEX_INITIALIZER;[m
 [m
 int main() {[m
[31m-  pthread_t thread1, thread2;[m
[32m+[m[32m  pthread_t thread1, thread2; // –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã –ø–æ—Ç–æ–∫–æ–≤[m
 [m
[32m+[m[32m  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é do_one_thing[m
   if (pthread_create(&thread1, NULL, (void *)do_one_thing,[m
 			  (void *)&common) != 0) {[m
[31m-    perror("pthread_create");[m
[31m-    exit(1);[m
[32m+[m[32m    perror("pthread_create"); // –í—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å[m
[32m+[m[32m    exit(1); // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏[m
   }[m
 [m
[32m+[m[32m  // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –ø–æ—Ç–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é do_another_thing[m
   if (pthread_create(&thread2, NULL, (void *)do_another_thing,[m
                      (void *)&common) != 0) {[m
     perror("pthread_create");[m
     exit(1);[m
   }[m
 [m
[32m+[m[32m  // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞[m
   if (pthread_join(thread1, NULL) != 0) {[m
     perror("pthread_join");[m
     exit(1);[m
   }[m
 [m
[32m+[m[32m  // –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –ø–æ—Ç–æ–∫–∞[m
   if (pthread_join(thread2, NULL) != 0) {[m
     perror("pthread_join");[m
     exit(1);[m
   }[m
 [m
[32m+[m[32m  // –í—ã–≤–æ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±–æ–∏—Ö –ø–æ—Ç–æ–∫–æ–≤[m
   do_wrap_up(common);[m
 [m
   return 0;[m
 }[m
 [m
[32m+[m[32m// –§—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –ø–µ—Ä–≤—ã–º –ø–æ—Ç–æ–∫–æ–º[m
 void do_one_thing(int *pnum_times) {[m
   int i, j, x;[m
   unsigned long k;[m
[31m-  int work;[m
[32m+[m[32m  int work; // –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ä–∞–±–æ—Ç—ã[m
[32m+[m[41m  [m
[32m+[m[32m  // –¶–∏–∫–ª –∏–∑ 50 –∏—Ç–µ—Ä–∞—Ü–∏–π, –∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é[m
   for (i = 0; i < 50; i++) {[m
[32m+[m
[32m+[m[32m    ////////////////[m
     // pthread_mutex_lock(&mut);[m
[31m-    printf("doing one thing\n");[m
[32m+[m[32m    ////////////////[m
[32m+[m[41m    [m
[32m+[m[32m    printf("doing one thing\n"); // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞[m
[32m+[m[41m    [m
[32m+[m[32m    // –ß—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é[m
     work = *pnum_times;[m
     printf("counter = %d\n", work);[m
[31m-    work++; /* increment, but not write */[m
[32m+[m[41m    [m
[32m+[m[32m    // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π[m
[32m+[m[32m    work++;[m[41m [m
[32m+[m[41m    [m
[32m+[m[32m    // –î–õ–ò–ù–ù–´–ô –¶–ò–ö–õ: –ò–º–∏—Ç–∞—Ü–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏[m
[32m+[m[32m    // –í–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç[m
     for (k = 0; k < 500000; k++)[m
[31m-      ;                 /* long cycle */[m
[31m-    *pnum_times = work; /* write back */[m
[31m-	// pthread_mutex_unlock(&mut);[m
[32m+[m[32m      ;[m[41m          [m
[32m+[m[41m    [m
[32m+[m[32m    // –ó–∞–ø–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—â—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é[m
[32m+[m[32m    *pnum_times = work;[m[41m [m
[32m+[m[41m    [m
[32m+[m[32m    //////////////////[m
[32m+[m[32m    // pthread_mutex_unlock(&mut);[m
[32m+[m[32m    /////////////////[m
[32m+[m
[32m+[m
[32m+[m[32m    // –ë–µ–∑ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –º—å—é—Ç–µ–∫—Å–∞ –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Å–µ–∫—Ü–∏—é[m
   }[m
 }[m
 [m
[32m+[m[32m// –§—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –≤—Ç–æ—Ä—ã–º –ø–æ—Ç–æ–∫–æ–º (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ –ø–µ—Ä–≤–æ–π)[m
 void do_another_thing(int *pnum_times) {[m
   int i, j, x;[m
   unsigned long k;[m
   int work;[m
[32m+[m[41m  [m
   for (i = 0; i < 50; i++) {[m
[32m+[m[32m    //////////////////////////////[m
     // pthread_mutex_lock(&mut);[m
[31m-    printf("doing another thing\n");[m
[32m+[m[32m    /////////////////////////////[m
[32m+[m[41m    [m
[32m+[m[32m    printf("doing another thing\n"); // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –≤—Ç–æ—Ä–æ–≥–æ –ø–æ—Ç–æ–∫–∞[m
[32m+[m[41m    [m
[32m+[m[32m    // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ï–ö–¶–ò–Ø –ù–ê–ß–ê–õ–û:[m
[32m+[m[32m    // –¢–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å —á—Ç–µ–Ω–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏—è-–∑–∞–ø–∏—Å–∏ –æ–±—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π[m
     work = *pnum_times;[m
     printf("counter = %d\n", work);[m
[31m-    work++; /* increment, but not write */[m
[32m+[m[32m    work++;[m[41m [m
[32m+[m[41m    [m
[32m+[m[32m    // –î–ª–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è - —Ç–æ—á–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞[m
     for (k = 0; k < 500000; k++)[m
[31m-      ;                 /* long cycle */[m
[31m-    *pnum_times = work; /* write back */[m
[32m+[m[32m      ;[m[41m                [m
[32m+[m[41m    [m
[32m+[m[32m    *pnum_times = work;[m[41m [m
[32m+[m[32m    // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –°–ï–ö–¶–ò–Ø –ö–û–ù–ï–¶:[m
[32m+[m[41m    [m
[32m+[m[32m    //////////////////////////[m
     // pthread_mutex_unlock(&mut);[m
[32m+[m[32m    //////////////////////////[m
   }[m
 }[m
 [m
[32m+[m[32m// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞[m
 void do_wrap_up(int counter) {[m
   int total;[m
[32m+[m[32m  // –û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 100 (50 –∏—Ç–µ—Ä–∞—Ü–∏–π √ó 2 –ø–æ—Ç–æ–∫–∞)[m
[32m+[m[32m  // –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ–∑ –º—å—é—Ç–µ–∫—Å–∞: –º–µ–Ω—å—à–µ 100 –∏–∑-–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏[m
   printf("All done, counter = %d\n", counter);[m
 }[m
[32m+[m
[32m+[m[32m/*[m
[32m+[m[32m–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò –ö –ü–û–í–ï–î–ï–ù–ò–Æ –ü–†–û–ì–†–ê–ú–ú–´:[m
[32m+[m
[32m+[m[32m–ë–ï–ó –ú–¨–Æ–¢–ï–ö–°–ê (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):[m
[32m+[m[32m- –í–æ–∑–Ω–∏–∫–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏ (race condition)[m
[32m+[m[32m- –û–±–∞ –ø–æ—Ç–æ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π common[m
[32m+[m[32m- –ü–æ—Ç–µ—Ä—è updates: –∫–æ–≥–¥–∞ –æ–±–∞ –ø–æ—Ç–æ–∫–∞ —á–∏—Ç–∞—é—Ç –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ,[m[41m [m
[32m+[m[32m  —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –µ–≥–æ –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –æ–±—Ä–∞—Ç–Ω–æ, –æ–¥–∏–Ω –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Ç–µ—Ä—è–µ—Ç—Å—è[m
[32m+[m[32m- –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ common –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ 100[m
[32m+[m
[32m+[m[32m–° –ú–¨–Æ–¢–ï–ö–°–û–ú (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å pthread_mutex_lock/unlock):[m
[32m+[m[32m- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–∞[m
[32m+[m[32m- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å common –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏[m
[32m+[m[32m- –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ common –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–æ 100[m
[32m+[m[32m- –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏–∑-–∑–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏[m
[32m+[m